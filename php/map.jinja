{% if salt['pillar.get']('php:version')|string == '7.0' %}

{% set php = salt['grains.filter_by']({
    'Debian': {
        'php_pkg': 'php7.0',
        'apc_pkg': 'php7.0-apcu-bc',
        'apcu_pkg': 'php7.0-apcu',
        'bcmath_pkg': 'php7.0-bcmath',
        'cli_pkg': 'php7.0-cli',
        'curl_pkg': 'php7.0-curl',
        'fpm_pkg': 'php7.0-fpm',
        'fpm_service': 'php7.0-fpm',
        'gd_pkg': 'php7.0-gd',
        'intl_pkg': 'php7.0-intl',
        'json_pkg': 'php7.0-json',
        'mcrypt_pkg': 'php7.0-mcrypt',
        'memcache_pkg': 'php7.0-memcached',
        'memcached_pkg': 'php7.0-memcached',
        'mysql_pkg': 'php7.0-mysql',
        'mbstring_pkg': 'php7.0-mbstring',
        'readline_pkg': ' php7.0-readline',
        'soap_pkg': 'php7.0-soap',
        'redis_pkg': 'php7.0-redis',
        'xml_pkg': 'php7.0-xml',
        'imagick_pkg': 'php7.0-imagick',
        'suhosin_pkg': 'php7.0-suhosin',
        'pgsql_pkg': 'php7.0-pgsql',
        'dev_pkg': 'php7.0-dev',
        'zip_pkg': 'php7.0-zip',
        'php_ini': '/etc/php7.0/apache2/php.ini',
        'sqlite_pkg': 'php7.0-sqlite3',
        'local_bin': '/usr/local/bin',
        'temp_dir': '/tmp',
        'composer_bin': 'composer',
    },
}, merge=salt['pillar.get']('php:lookup')) %}

{% else %}

    {% if salt['grains.get']('os') == 'Ubuntu' %}
        {% if salt['grains.get']('osrelease')|string >= '16.04' %}
        {% set php = salt['grains.filter_by']({
             'Ubuntu': {
                'php_pkg': 'php',
                'apc_pkg': 'php',
                'apcu_pkg': 'php-apcu',
                'cgi_pkg': 'php-cgi',
                'cli_pkg': 'php-cli',
                'curl_pkg': 'php-curl',
                'fpm_pkg': 'php-fpm',
                'fpm_service': 'php7.0-fpm',
                'gd_pkg': 'php-gd',
                'oauth_pkg': 'php-oauth',
                'intl_pkg': 'php-intl',
                'json_pkg': 'php-json',
                'mail_pkg': 'php-mail',
                'mbstring_pkg': 'php-mbstring',
                'mcrypt_pkg': 'php-mcrypt',
                'memcache_pkg': 'php-memcache',
                'memcached_pkg': 'php-memcached',
                'mysql_pkg': 'php-mysql',
                'mysqlnd_pkg': 'php',
                'pear_pkg': 'php-pear',
                'readline_pkg': ' php-readline',
                'soap_pkg': 'php-soap',
                'sqlite_pkg': 'php-sqlite3',
                'redis_pkg': 'php-redis',
                'xml_pkg': 'php-xml',
                'imagick_pkg': 'php-imagick',
                'suhosin_pkg': 'php',
                'imap_pkg': 'php-imap',
                'adodb_pkg': 'libphp-adodb',
                'pgsql_pkg': 'php-pgsql',
                'ldap_pkg': 'php-ldap',
                'php_ini': '/etc/php/7.0/apache2/php.ini',
                'dev_pkg': 'php-dev',
                'mongo_pecl': 'php-mongodb',
                'mongo_ext': 'mongodb.so',
                'ext_conf_path': '/etc/php/7.0/mods-available',
                'local_bin': '/usr/local/bin',
                'temp_dir': '/tmp',
                'composer_bin': 'composer',
                }
            }, grain="os"
            , merge=salt['pillar.get']('php:lookup')) %}
        {% else %}
        {% set php = salt['grains.filter_by']({
            'Ubuntu': {
                'php_pkg': 'php5',
                'apc_pkg': 'php-apc',
                'apcu_pkg': 'php5-apcu',
                'cgi_pkg': 'php5-cgi',
                'cli_pkg': 'php5-cli',
                'curl_pkg': 'php5-curl',
                'fpm_pkg': 'php5-fpm',
                'fpm_service': 'php5-fpm',
                'gd_pkg': 'php5-gd',
                'oauth_pkg': 'php5-oauth',
                'intl_pkg': 'php5-intl',
                'json_pkg': 'php5-json',
                'mail_pkg': 'php-mail',
                'mbstring_pkg': 'php5',
                'mcrypt_pkg': 'php5-mcrypt',
                'memcache_pkg': 'php5-memcache',
                'memcached_pkg': 'php5-memcached',
                'mysql_pkg': 'php5-mysql',
                'mysqlnd_pkg': 'php5-mysqlnd',
                'pear_pkg': 'php-pear',
                'readline_pkg': ' php5-readline',
                'soap_pkg': 'php-soap',
                'sqlite_pkg': 'php5-sqlite',
                'redis_pkg': 'php5-redis',
                'xml_pkg': 'php5',
                'imagick_pkg': 'php5-imagick',
                'suhosin_pkg': 'php5-suhosin',
                'imap_pkg': 'php5-imap',
                'adodb_pkg': 'php5-adodb',
                'pgsql_pkg': 'php5-pgsql',
                'ldap_pkg': 'php5-ldap',
                'php_ini': '/etc/php5/apache2/php.ini',
                'dev_pkg': 'php5-dev',
                'mongo_pecl': 'mongo',
                'mongo_ext': 'mongo.so',
                'ext_conf_path': '/etc/php5/mods-available',
                'local_bin': '/usr/local/bin',
                'temp_dir': '/tmp',
                'composer_bin': 'composer',
            },
        }, grain='os'
        , merge=salt['pillar.get']('php:lookup')) %}
        {% endif %}
    {% else %}
    {% set php = salt['grains.filter_by']({
        'Debian': {
            'php_pkg': 'php5',
            'apc_pkg': 'php-apc',
            'apcu_pkg': 'php5-apcu',
            'cgi_pkg': 'php5-cgi',
            'cli_pkg': 'php5-cli',
            'curl_pkg': 'php5-curl',
            'fpm_pkg': 'php5-fpm',
            'fpm_service': 'php5-fpm',
            'gd_pkg': 'php5-gd',
            'oauth_pkg': 'php5-oauth',
            'intl_pkg': 'php5-intl',
            'json_pkg': 'php5-json',
            'mail_pkg': 'php-mail',
            'mbstring_pkg': 'php5',
            'mcrypt_pkg': 'php5-mcrypt',
            'memcache_pkg': 'php5-memcache',
            'memcached_pkg': 'php5-memcached',
            'mysql_pkg': 'php5-mysql',
            'mysqlnd_pkg': 'php5-mysqlnd',
            'pear_pkg': 'php-pear',
            'readline_pkg': ' php5-readline',
            'soap_pkg': 'php-soap',
            'sqlite_pkg': 'php5-sqlite',
            'redis_pkg': 'php5-redis',
            'xml_pkg': 'php5',
            'imagick_pkg': 'php5-imagick',
            'suhosin_pkg': 'php5-suhosin',
            'imap_pkg': 'php5-imap',
            'adodb_pkg': 'php5-adodb',
            'pgsql_pkg': 'php5-pgsql',
            'ldap_pkg': 'php5-ldap',
            'php_ini': '/etc/php5/apache2/php.ini',
            'dev_pkg': 'php5-dev',
            'mongo_pecl': 'mongo',
            'mongo_ext': 'mongo.so',
            'ext_conf_path': '/etc/php5/mods-available',
            'local_bin': '/usr/local/bin',
            'temp_dir': '/tmp',
            'composer_bin': 'composer',
        },
        'RedHat': {
            'php_pkg': 'php',
            'apc_pkg': 'php-pecl-apc',
            'apcu_pkg': 'php-pecl-apcu',
            'cgi_pkg': 'php-cgi',
            'cli_pkg': 'php-cli',
            'curl_pkg': 'curl',
            'fpm_pkg': 'php-fpm',
            'gd_pkg': 'php-gd',
            'oauth_pkg': 'php-oauth',
            'intl_pkg': 'php-intl',
            'json_pkg': 'php-common',
            'mbstring_pkg': 'php-mbstring',
            'mcrypt_pkg': 'php-mcrypt',
            'memcache_pkg': 'php-pecl-memcache',
            'memcached_pkg': 'php-pecl-memcached',
            'mysql_pkg': 'php-mysql',
            'mysqlnd_pkg': 'php-mysqlnd',
            'pear_pkg': 'php-pear',
            'readline_pkg': ' php-readline',
            'soap_pkg': 'php-soap',
            'sqlite_pkg': 'php5-sqlite',
            'redis_pkg': 'php-redis',
            'fpm_service': 'php-fpm',
            'xml_pkg': 'php-xml',
            'imagick_pkg': 'php-pecl-imagick',
            'suhosin_pkg': 'php-suhosin',
            'imap_pkg': 'php-imap',
            'adodb_pkg': 'php-adodb',
            'pgsql_pkg': 'php-pgsql',
            'ldap_pkg': 'php-ldap',
            'php_ini': '/etc/php.ini',
            'dev_pkg': 'php-dev',
            'zip_pkg': 'php',
            'mongo_pecl': 'mongo',
            'mongo_ext': 'mongo.so',
            'ext_conf_path': '/etc/php5/conf.d',
            'local_bin': '/usr/local/bin',
            'temp_dir': '/tmp',
            'composer_bin': 'composer',
        },
        'Suse': {
            'php_pkg': 'php5',
            'cli_pkg': 'php5-cli',
            'curl_pkg': 'php5-curl',
            'fpm_pkg': 'php5-fpm',
            'gd_pkg': 'php5-gd',
            'intl_pkg': 'php5-intl',
            'json_pkg': 'php5-json',
            'mbstring_pkg': 'php5-mbstring',
            'mcrypt_pkg': 'php5-mcrypt',
            'mysql_pkg': 'php5-mysql',
            'pear_pkg': 'php5-pear',
            'readline_pkg': ' php5-readline',
            'soap_pkg': 'php5-soap',
            'sqlite_pkg': 'php5-sqlite',
            'fpm_service': 'php5-fpm',
            'xml_pkg': ['php5-xmlreader','php5-xmlwriter','php5-xmlrpc'],
            'suhosin_pkg': 'php5-suhosin',
            'imap_pkg': 'php5-imap',
            'adodb_pkg': 'php5-dba',
            'pgsql_pkg': 'php5-pgsql',
            'ldap_pkg': 'php5-ldap',
            'php_ini': '/etc/php5/apache2/php.ini',
            'dev_pkg': 'php5-devel',
            'zip_pkg': 'php5-zip',
            'mongo_pecl': 'mongo',
            'mongo_ext': 'mongo.so',
            'ext_conf_path': '/etc/php5/conf.d',
            'local_bin': '/usr/local/bin',
            'temp_dir': '/tmp',
            'composer_bin': 'composer',
        },

    }, merge=salt['pillar.get']('php:lookup')) %}
    {% endif %}
{% endif %}
